function subscribe(t){socket.send(JSON.stringify({action:"subscribe",message:{assetId:t}}))}function maxPoint(t){var n=0;return t.forEach(function(t){n=t.value>n?t.value:n}),n}function minPoint(t){var n=t[0].value;return t.forEach(function(t){n=t.value<n?t.value:n}),n}function getHeightPoint(t,n,i){var s=(graphHeight-startY)/(n-i),o=t-i;return o*s}function Point(t,n){this.x=t,this.y=n,this.constraint={}}function Graph(t){this.bPoints=t,this.points=[],this.updatePoints()}var points=[],canvas,ctx,socket,graph,graphWidth=700,graphHeight=450,bottomSpace=100,startY=50,greedLineCount=7;window.onload=function(){socket=new WebSocket("ws://128.199.49.24:1234"),canvas=document.getElementById("finance"),canvas.width=800,canvas.height=600,ctx=canvas.getContext("2d"),socket.onopen=function(){socket.send(JSON.stringify({action:"assets",message:{}}))},socket.onmessage=function(t){var n=JSON.parse(t.data);"assets"==n.action&&subscribe(n.message.assets[0].id),"asset_history"==n.action&&(points=n.message.points,graph=new Graph(points)),"point"==n.action&&(points.shift(),points.push(n.message),graph.updatePoints(points))}},Point.prototype.addConstraint=function(t,n){this.constraint={x:t,y:n}},Point.prototype.start=function(){ctx.moveTo(this.x,this.y)},Point.prototype.draw=function(){ctx.lineTo(this.constraint.x,this.constraint.y)},Graph.prototype.updatePoints=function(t){this.points=[],t&&(this.bPoints=t);var n=this,i=maxPoint(this.bPoints),s=minPoint(this.bPoints),o=graphWidth/this.bPoints.length,a=new Point(0,graphHeight+bottomSpace);this.points.push(a),this.bPoints.map(function(t,a){var e=a*o,c=graphHeight-getHeightPoint(t.value,i,s),t=new Point(e,c);n.points[n.points.length-1].addConstraint(e,c),n.points.push(t)}),this.points[this.points.length-1].addConstraint(graphWidth,graphHeight+bottomSpace),this.draw()},Graph.prototype.draw=function(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.beginPath(),this.points.map(function(t,n){0==n&&t.start(),t.draw()}),ctx.closePath(),ctx.strokeStyle="#c68549",ctx.fillStyle="rgba(255,166,77,0.9)",ctx.fill(),ctx.stroke()};